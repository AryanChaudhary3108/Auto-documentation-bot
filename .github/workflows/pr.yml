# GitHub Actions Workflow for DocuGen AI Bot
# Triggers on pull request events and runs the documentation bot

name: DocuGen AI Bot

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    name: Generate PR Documentation

    permissions:
      pull-requests: write    # Needed to post PR comments
      contents: read          # Needed to checkout code

    steps:
      # Step 1: Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for comparing changes

      # Step 2: Set up Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # Step 3: Install dependencies
      - name: Install dependencies
        run: npm install

      # Step 4: Run the DocuGen AI bot
      - name: Run DocuGen AI Bot
        run: node bot.js --local
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPO: ${{ github.repository }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
